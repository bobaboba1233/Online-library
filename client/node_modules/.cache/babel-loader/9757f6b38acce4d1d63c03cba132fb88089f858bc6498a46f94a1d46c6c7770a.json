{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\\\u0431\\u043E\\u0433\\u0434\\u0430\\u043D\\\\Documents\\\\GitHub\\\\Online-library\\\\client\\\\src\\\\pages\\\\Home.jsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, Suspense } from \"react\";\nimport Card from \"../components/Card\";\nimport axios from \"axios\";\nimport \"../styles/Home.css\";\nimport Header from \"../components/Header\";\n\n// Настройка axios для обработки ошибок 401\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\naxios.interceptors.response.use(response => response, error => {\n  var _error$response;\n  if (((_error$response = error.response) === null || _error$response === void 0 ? void 0 : _error$response.status) === 401) {\n    localStorage.removeItem(\"token\");\n    window.location.reload(); // Обновляем страницу при истечении токена\n  }\n  return Promise.reject(error);\n});\nconst AuthModal = /*#__PURE__*/React.lazy(_c = () => import(\"../components/Auth/AuthModal\"));\n_c2 = AuthModal;\nfunction Home() {\n  _s();\n  const [books, setBooks] = useState([]);\n  const [userData, setUserData] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [showAuthModal, setShowAuthModal] = useState(false);\n  const fetchData = async (query = \"\") => {\n    try {\n      setLoading(true);\n      const token = localStorage.getItem(\"token\");\n      const headers = token ? {\n        Authorization: `Bearer ${token}`\n      } : {};\n      const booksPromise = axios.get(`http://localhost:5000/api/books?search=${encodeURIComponent(query)}`, {\n        headers\n      });\n      let userPromise = Promise.resolve(null);\n      if (token) {\n        userPromise = axios.get(\"http://localhost:5000/api/auth/profile\", {\n          headers: {\n            Authorization: `Bearer ${token}`\n          }\n        });\n      }\n      const [booksRes, userRes] = await Promise.all([booksPromise, userPromise]);\n      setBooks(booksRes.data);\n      if (userRes) {\n        setUserData(userRes.data);\n      }\n    } catch (err) {\n      var _err$response, _err$response$data, _err$response2;\n      setError(((_err$response = err.response) === null || _err$response === void 0 ? void 0 : (_err$response$data = _err$response.data) === null || _err$response$data === void 0 ? void 0 : _err$response$data.message) || err.message);\n      if (((_err$response2 = err.response) === null || _err$response2 === void 0 ? void 0 : _err$response2.status) === 401) {\n        setUserData(null);\n      }\n    } finally {\n      setLoading(false);\n    }\n  };\n  useEffect(() => {\n    fetchData();\n  }, []);\n  const handleSearch = query => {\n    setSearchQuery(query);\n    fetchData(query);\n  };\n  const handleAuthClick = () => {\n    setShowAuthModal(true);\n  };\n  if (loading) return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"loading\",\n    children: \"\\u0417\\u0430\\u0433\\u0440\\u0443\\u0437\\u043A\\u0430...\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 75,\n    columnNumber: 23\n  }, this);\n  if (error) return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"error\",\n    children: error\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 76,\n    columnNumber: 21\n  }, this);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"home\",\n    children: [/*#__PURE__*/_jsxDEV(Header, {\n      onSearch: handleSearch,\n      onAuthClick: handleAuthClick,\n      isLoggedIn: !!userData,\n      userData: userData\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 80,\n      columnNumber: 7\n    }, this), showAuthModal && /*#__PURE__*/_jsxDEV(Suspense, {\n      fallback: /*#__PURE__*/_jsxDEV(\"div\", {\n        children: \"\\u0417\\u0430\\u0433\\u0440\\u0443\\u0437\\u043A\\u0430...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 88,\n        columnNumber: 29\n      }, this),\n      children: /*#__PURE__*/_jsxDEV(AuthModal, {\n        onClose: () => setShowAuthModal(false),\n        onLoginSuccess: user => {\n          setUserData(user);\n          setShowAuthModal(false);\n          fetchData(searchQuery);\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 89,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"book-list\",\n      children: books.length > 0 ? books.map(book => {\n        var _userData$subscriptio;\n        return /*#__PURE__*/_jsxDEV(Card, {\n          book: book,\n          isSubscribed: (userData === null || userData === void 0 ? void 0 : (_userData$subscriptio = userData.subscription) === null || _userData$subscriptio === void 0 ? void 0 : _userData$subscriptio.isActive) || false,\n          token: localStorage.getItem(\"token\")\n        }, book._id, false, {\n          fileName: _jsxFileName,\n          lineNumber: 103,\n          columnNumber: 13\n        }, this);\n      }) : /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"no-results\",\n        children: searchQuery ? \"Ничего не найдено\" : \"Книги не найдены\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 111,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 79,\n    columnNumber: 5\n  }, this);\n}\n_s(Home, \"y+rxKZDMxFROAyz02HppyG+dGuY=\");\n_c3 = Home;\nexport default Home;\nvar _c, _c2, _c3;\n$RefreshReg$(_c, \"AuthModal$React.lazy\");\n$RefreshReg$(_c2, \"AuthModal\");\n$RefreshReg$(_c3, \"Home\");","map":{"version":3,"names":["React","useState","useEffect","Suspense","Card","axios","Header","jsxDEV","_jsxDEV","interceptors","response","use","error","_error$response","status","localStorage","removeItem","window","location","reload","Promise","reject","AuthModal","lazy","_c","_c2","Home","_s","books","setBooks","userData","setUserData","loading","setLoading","setError","searchQuery","setSearchQuery","showAuthModal","setShowAuthModal","fetchData","query","token","getItem","headers","Authorization","booksPromise","get","encodeURIComponent","userPromise","resolve","booksRes","userRes","all","data","err","_err$response","_err$response$data","_err$response2","message","handleSearch","handleAuthClick","className","children","fileName","_jsxFileName","lineNumber","columnNumber","onSearch","onAuthClick","isLoggedIn","fallback","onClose","onLoginSuccess","user","length","map","book","_userData$subscriptio","isSubscribed","subscription","isActive","_id","_c3","$RefreshReg$"],"sources":["C:/Users/богдан/Documents/GitHub/Online-library/client/src/pages/Home.jsx"],"sourcesContent":["import React, { useState, useEffect, Suspense } from \"react\";\r\nimport Card from \"../components/Card\";\r\nimport axios from \"axios\";\r\nimport \"../styles/Home.css\";\r\nimport Header from \"../components/Header\";\r\n\r\n// Настройка axios для обработки ошибок 401\r\naxios.interceptors.response.use(\r\n  response => response,\r\n  error => {\r\n    if (error.response?.status === 401) {\r\n      localStorage.removeItem(\"token\");\r\n      window.location.reload(); // Обновляем страницу при истечении токена\r\n    }\r\n    return Promise.reject(error);\r\n  }\r\n);\r\n\r\nconst AuthModal = React.lazy(() => import(\"../components/Auth/AuthModal\"));\r\n\r\nfunction Home() {\r\n  const [books, setBooks] = useState([]);\r\n  const [userData, setUserData] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState(null);\r\n  const [searchQuery, setSearchQuery] = useState(\"\");\r\n  const [showAuthModal, setShowAuthModal] = useState(false);\r\n\r\n  const fetchData = async (query = \"\") => {\r\n    try {\r\n      setLoading(true);\r\n      const token = localStorage.getItem(\"token\");\r\n      const headers = token ? { Authorization: `Bearer ${token}` } : {};\r\n\r\n      const booksPromise = axios.get(\r\n        `http://localhost:5000/api/books?search=${encodeURIComponent(query)}`,\r\n        { headers }\r\n      );\r\n\r\n      let userPromise = Promise.resolve(null);\r\n      if (token) {\r\n        userPromise = axios.get(\"http://localhost:5000/api/auth/profile\", {\r\n          headers: { Authorization: `Bearer ${token}` }\r\n        });\r\n      }\r\n\r\n      const [booksRes, userRes] = await Promise.all([booksPromise, userPromise]);\r\n      setBooks(booksRes.data);\r\n      if (userRes) {\r\n        setUserData(userRes.data);\r\n      }\r\n    } catch (err) {\r\n      setError(err.response?.data?.message || err.message);\r\n      if (err.response?.status === 401) {\r\n        setUserData(null);\r\n      }\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    fetchData();\r\n  }, []);\r\n\r\n  const handleSearch = (query) => {\r\n    setSearchQuery(query);\r\n    fetchData(query);\r\n  };\r\n\r\n  const handleAuthClick = () => {\r\n    setShowAuthModal(true);\r\n  };\r\n\r\n  if (loading) return <div className=\"loading\">Загрузка...</div>;\r\n  if (error) return <div className=\"error\">{error}</div>;\r\n\r\n  return (\r\n    <div className=\"home\">\r\n      <Header\r\n        onSearch={handleSearch}\r\n        onAuthClick={handleAuthClick}\r\n        isLoggedIn={!!userData}\r\n        userData={userData}\r\n      />\r\n\r\n      {showAuthModal && (\r\n        <Suspense fallback={<div>Загрузка...</div>}>\r\n          <AuthModal \r\n            onClose={() => setShowAuthModal(false)} \r\n            onLoginSuccess={(user) => {\r\n              setUserData(user);\r\n              setShowAuthModal(false);\r\n              fetchData(searchQuery);\r\n            }}\r\n          />\r\n        </Suspense>\r\n      )}\r\n\r\n      <div className=\"book-list\">\r\n        {books.length > 0 ? (\r\n          books.map((book) => (\r\n            <Card\r\n              key={book._id}\r\n              book={book}\r\n              isSubscribed={userData?.subscription?.isActive || false}\r\n              token={localStorage.getItem(\"token\")}\r\n            />\r\n          ))\r\n        ) : (\r\n          <div className=\"no-results\">\r\n            {searchQuery ? \"Ничего не найдено\" : \"Книги не найдены\"}\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Home;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}